<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Reading and writing RData files
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="An F# Type Provider providing strongly typed access to the R statistical package">
    <meta name="author" content="BlueMountain Capital">

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="http://bluemountaincapital.github.io/FSharpRProvider/content/style.css" />
    <script type="text/javascript" src="http://bluemountaincapital.github.io/FSharpRProvider/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="http://bluemountaincapital.github.io/Deedle"><img height="16" width="16" src="http://fsharp.org/images/thumbs/Deedle.png" /> Deedle</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Charting/"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Charting.png" /> F# Charting</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Data"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Data.png" /> F# Data</a></li>
          <li><a href="http://fsprojects.github.io/FSharp.Data.Toolbox"><img height="16" width="16" src="http://fsharp.org/images/thumbs/FSharp.Data.Toolbox.png" /> F# Data Toolbox</a></li>
        </ul>
        <h3 class="muted"><a href="http://bluemountaincapital.github.io/FSharpRProvider/index.html">R Type Provider</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1>Reading and writing RData files</h1>

<p>When using R, you can save and load data sets as <code>*.rdata</code> files. These can be easily
exported and consumed using the R provider too, so if you want to perform part of your
data acquisition, analysis and visualization using F# and another part using R, you 
can easily pass the data between F# and R as <code>*.rdata</code> files.</p>

<h2>Passing data from R to F#</h2>

<p>Let's say that you have some data in R and want to pass them to F#. To do that, you
can use the <code>save</code> function in R. The following R snippet creates a simple <code>*.rdata</code>
file containing a couple of symbols from the sample <code>volcano</code> data set:</p>

<pre lang="text">require(datasets)
volcanoList &lt;- unlist(as.list(volcano))
volcanoMean &lt;- mean(volcanoList)
symbols &lt;- c(&quot;volcano&quot;, &quot;volcanoList&quot;, &quot;volcanoMean&quot;)
save(list=symols, file=&quot;C:/data/sample.rdata&quot;)</pre>

<p>To import the data on the F# side, you can use the <code>RData</code> type provider that is
available in the <code>RProvider</code> namespace. It takes a static parameter specifying the
path of the file (absolute or relative) and generates a type that exposes all the
saved values as static members:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
<span class="l">5: </span>
<span class="l">6: </span>
<span class="l">7: </span>
<span class="l">8: </span>
<span class="l">9: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">RProvider</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Sample</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">RData</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">data</span><span class="s">/</span><span class="s">sample</span><span class="s">.</span><span class="s">rdata</span><span class="s">&quot;</span><span class="o">&gt;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">sample</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 5)" onmouseover="showTip(event, 'fs2', 5)" class="i">Sample</span>()

<span class="c">// Easily access saved values</span>
<span onmouseout="hideTip(event, 'fs4', 6)" onmouseover="showTip(event, 'fs4', 6)" class="i">sample</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs5', 7)" onmouseover="showTip(event, 'fs5', 7)" class="i">volcano</span>
<span onmouseout="hideTip(event, 'fs4', 8)" onmouseover="showTip(event, 'fs4', 8)" class="i">sample</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 9)" onmouseover="showTip(event, 'fs6', 9)" class="i">volcanoList</span>
<span onmouseout="hideTip(event, 'fs4', 10)" onmouseover="showTip(event, 'fs4', 10)" class="i">sample</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 11)" onmouseover="showTip(event, 'fs7', 11)" class="i">volcanoMean</span></pre>
</td>
</tr>
</table>

<p>When accessed, the type provider automatically converts the data from the R format
to F# format. In the above example, <code>volcanoList</code> is imported as <code>float[]</code> and
the <code>volcanoMean</code> value is a singleton array. (The provider does not detect that 
this is a singleton, so you can get the value using <code>sample.volcanoMean.[0]</code>).
For the <code>sample.volcano</code> value, the R provider does not have a default conversion
and so it is exposed as <code>SymbolicExpression</code>.</p>

<p>When you have a number of <code>*.rdata</code> files containing data in the same format, you can
pick one of them as a sample (which will be used to determine the fields of the type)
and then pass the file name to the constructor of the generated type to load it.
For example, if we had files <code>data/sample_1.rdata</code> to <code>data/sample_10.rdata</code>, we could
read them as:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
<span class="l">4: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="i">means</span> <span class="o">=</span> 
  [ <span class="k">for</span> <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="i">i</span> <span class="k">in</span> <span class="n">1</span> <span class="o">..</span> <span class="n">10</span> <span class="k">-&gt;</span>
      <span class="k">let</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="i">data</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs2', 15)" onmouseover="showTip(event, 'fs2', 15)" class="i">Sample</span>(<span onmouseout="hideTip(event, 'fs11', 16)" onmouseover="showTip(event, 'fs11', 16)" class="i">sprintf</span> <span class="s">&quot;</span><span class="s">data</span><span class="s">/</span><span class="s">sample_</span><span class="s">%</span><span class="s">d</span><span class="s">.</span><span class="s">rdata</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="i">i</span>)
      <span onmouseout="hideTip(event, 'fs10', 18)" onmouseover="showTip(event, 'fs10', 18)" class="i">data</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs7', 19)" onmouseover="showTip(event, 'fs7', 19)" class="i">volcanoMean</span><span class="o">.</span>[<span class="n">0</span>] ]</pre>
</td>
</tr>
</table>

<p>Note that the default conversions available depend on the plugins that are currently
available. For example, when you install the enrie <a href="http://www.fslab.org">FsLab</a> package
with the <a href="http://bluemountaincapital.github.io/Deedle/">Deedle</a> library, the <code>RData</code> 
provider will automatically expose data frames as Deedle <code>Frame&lt;string, string&gt;</code> values.</p>

<h2>Passing data from F# to R</h2>

<p>If you perform data acquisition in F# and then want to pass the data to R, you 
can use the standard R functions for saving the <code>*.rdata</code> files. The easiest 
option is to call the <code>R.assign</code> function to define named values in the R environment
and then use <code>R.save</code> to save the environment to a file:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 20)" onmouseover="showTip(event, 'fs1', 20)" class="i">RProvider</span><span class="o">.</span><span class="i">``base``</span>

<span class="c">// Calculate sum of square differences</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs12', 21)" onmouseover="showTip(event, 'fs12', 21)" class="i">avg</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs4', 22)" onmouseover="showTip(event, 'fs4', 22)" class="i">sample</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 23)" onmouseover="showTip(event, 'fs6', 23)" class="i">volcanoList</span> <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 24)" onmouseover="showTip(event, 'fs13', 24)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs14', 25)" onmouseover="showTip(event, 'fs14', 25)" class="i">average</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs15', 26)" onmouseover="showTip(event, 'fs15', 26)" class="i">sqrs</span> <span class="o">=</span> 
  <span onmouseout="hideTip(event, 'fs4', 27)" onmouseover="showTip(event, 'fs4', 27)" class="i">sample</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs6', 28)" onmouseover="showTip(event, 'fs6', 28)" class="i">volcanoList</span> 
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs13', 29)" onmouseover="showTip(event, 'fs13', 29)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs16', 30)" onmouseover="showTip(event, 'fs16', 30)" class="i">map</span> (<span class="k">fun</span> <span onmouseout="hideTip(event, 'fs17', 31)" onmouseover="showTip(event, 'fs17', 31)" class="i">v</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs18', 32)" onmouseover="showTip(event, 'fs18', 32)" class="i">pown</span> (<span onmouseout="hideTip(event, 'fs17', 33)" onmouseover="showTip(event, 'fs17', 33)" class="i">v</span> <span class="o">-</span> <span onmouseout="hideTip(event, 'fs12', 34)" onmouseover="showTip(event, 'fs12', 34)" class="i">avg</span>) <span class="n">2</span>)

<span class="c">// Save the squares to an RData file</span>
<span onmouseout="hideTip(event, 'fs19', 35)" onmouseover="showTip(event, 'fs19', 35)" class="i">R</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs20', 36)" onmouseover="showTip(event, 'fs20', 36)" class="i">assign</span>(<span class="s">&quot;</span><span class="s">volcanoDiffs</span><span class="s">&quot;</span>, <span onmouseout="hideTip(event, 'fs15', 37)" onmouseover="showTip(event, 'fs15', 37)" class="i">sqrs</span>)
<span onmouseout="hideTip(event, 'fs19', 38)" onmouseover="showTip(event, 'fs19', 38)" class="i">R</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs21', 39)" onmouseover="showTip(event, 'fs21', 39)" class="i">save</span>(<span onmouseout="hideTip(event, 'fs22', 40)" onmouseover="showTip(event, 'fs22', 40)" class="i">list</span><span class="o">=</span>[ <span class="s">&quot;</span><span class="s">volcanoDiffs</span><span class="s">&quot;</span> ], <span class="i">file</span><span class="o">=</span><span class="s">&quot;</span><span class="s">C</span><span class="s">:</span><span class="s">/</span><span class="s">temp</span><span class="s">/</span><span class="s">volcano</span><span class="s">.</span><span class="s">rdata</span><span class="s">&quot;</span>)</pre>
</td>
</tr>
</table>

<p>It is recommended to use the <code>list</code> parameter of the <code>save</code> function to specify the
names of the symbols that should be saved, rather than saving <em>all</em> symbols. The R
provider uses additional temporary symbols and so the saved file would otherwise contain
unnecessary fileds.</p>

<p>Once you save the file using the above command, you can re-load it again using
the <code>RData</code> type provider, such as: <code>new RData&lt;"C:/temp/volcano.rdata"&gt;()</code>.</p>

<div class="tip" id="fs1">namespace RProvider</div>
<div class="tip" id="fs2">type Sample = RData&lt;...&gt;<br /><br />Full name: Reading-rdata.Sample</div>
<div class="tip" id="fs3">type RData<br /><br />Full name: RProvider.RData</div>
<div class="tip" id="fs4">val sample : RData&lt;...&gt;<br /><br />Full name: Reading-rdata.sample</div>
<div class="tip" id="fs5">property RData&lt;...&gt;.volcano: RDotNet.SymbolicExpression</div>
<div class="tip" id="fs6">property RData&lt;...&gt;.volcanoList: float []</div>
<div class="tip" id="fs7">property RData&lt;...&gt;.volcanoMean: float []</div>
<div class="tip" id="fs8">val means : float list<br /><br />Full name: Reading-rdata.means</div>
<div class="tip" id="fs9">val i : int</div>
<div class="tip" id="fs10">val data : RData&lt;...&gt;</div>
<div class="tip" id="fs11">val sprintf : format:Printf.StringFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.sprintf</div>
<div class="tip" id="fs12">val avg : float<br /><br />Full name: Reading-rdata.avg</div>
<div class="tip" id="fs13">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : params indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs14">val average : array:&#39;T [] -&gt; &#39;T (requires member ( + ) and member DivideByInt and member get_Zero)<br /><br />Full name: Microsoft.FSharp.Collections.Array.average</div>
<div class="tip" id="fs15">val sqrs : float []<br /><br />Full name: Reading-rdata.sqrs</div>
<div class="tip" id="fs16">val map : mapping:(&#39;T -&gt; &#39;U) -&gt; array:&#39;T [] -&gt; &#39;U []<br /><br />Full name: Microsoft.FSharp.Collections.Array.map</div>
<div class="tip" id="fs17">val v : float</div>
<div class="tip" id="fs18">val pown : x:&#39;T -&gt; n:int -&gt; &#39;T (requires member get_One and member ( * ) and member ( / ))<br /><br />Full name: Microsoft.FSharp.Core.Operators.pown</div>
<div class="tip" id="fs19">type R =<br />&#160;&#160;static member ! : ?paramArray: obj [] -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member != : ?paramArray: obj [] -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member !_hexmode : ?a: obj -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member !_octmode : ?a: obj -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member $ : ?paramArray: obj [] -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member $&lt;- : ?paramArray: obj [] -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member $&lt;-_data_frame : ?x: obj * ?name: obj * ?value: obj -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member $_DLLInfo : ?x: obj * ?name: obj -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member $_package__version : ?x: obj * ?name: obj -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;static member %% : ?paramArray: obj [] -&gt; SymbolicExpression + 1 overload<br />&#160;&#160;...<br /><br />Full name: RProvider.base.R<br /><em><br /><br />Base R functions</em></div>
<div class="tip" id="fs20">R.assign(paramsByName: Collections.Generic.IDictionary&lt;string,obj&gt;) : RDotNet.SymbolicExpression<br />R.assign(?x: obj, ?value: obj, ?pos: obj, ?envir: obj, ?inherits: obj, ?immediate: obj) : RDotNet.SymbolicExpression<br /><em><br /><br />Assign a Value to a Name</em></div>
<div class="tip" id="fs21">R.save(paramsByName: Collections.Generic.IDictionary&lt;string,obj&gt;) : RDotNet.SymbolicExpression<br />R.save(?___: obj, ?list: obj, ?file: obj, ?ascii: obj, ?version: obj, ?envir: obj, ?compress: obj, ?compression__level: obj, ?eval_promises: obj, ?precheck: obj, ?paramArray: obj []) : RDotNet.SymbolicExpression<br /><em><br /><br />Save R Objects</em></div>
<div class="tip" id="fs22">type &#39;T list = List&lt;&#39;T&gt;<br /><br />Full name: Microsoft.FSharp.Collections.list&lt;_&gt;</div>

        </div>
        <div class="span3">
          <a href="https://nuget.org/packages/RProvider">
            <img src="http://bluemountaincapital.github.io/FSharpRProvider/images/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">R Type Provider</li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/RProvider">Get Library via NuGet</a></li>
            <li><a href="http://github.com/BlueMountainCapital/FSharpRProvider">Source Code on GitHub</a></li>
            <li><a href="http://github.com/BlueMountainCapital/FSharpRProvider/blob/master/LICENSE.md">License (BSD)</a></li>
            <li><a href="http://github.com/BlueMountainCapital/FSharpRProvider/blob/master/RELEASE_NOTES.md">Release Notes</a></li>
            <li><a href="http://github.com/BlueMountainCapital/FSharpRProvider/issues">Bug reports & feature requests</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/Statistics-QuickStart.html">Statistics</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/Charts-QuickStart.html">Creating charts</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/reading-rdata.html">Reading and writing RData</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/passing-data.html">Passing data between F# and R</a></li>
            <li class="divider"></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/tutorial.html">Analysing stock prices</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/howto.html">R packages & naming</a></li>

            <li class="nav-header">Reference</li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/reference/index.html">API Reference</a></li>
       
            <li class="nav-header">Internals</li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/devnotes.html">Developer notes</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/whatwhy.html">Whats and whys</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/internals.html">How does it work</a></li>
            
          </ul>
        </div>
      </div>
    </div>
    <a href="http://github.com/BlueMountainCapital/FSharpRProvider"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date(); a = s.createElement(o),
        m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
      ga('create', 'UA-45379232-2', 'bluemountaincapital.github.io');
      ga('send', 'pageview');
    </script>
  </body>
</html>