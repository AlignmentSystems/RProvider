<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>How to
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="The F# Data library implements type providers for working with structured file formats (CSV, JSON and XML) and for accessing the WorldBank and Freebase data. It also includes helpers for other data-related tasks.">
    <meta name="author" content="Tomas Petricek">

    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="http://tpetricek.github.io/FSharp.RProvider//content/style.css" />
    <script src="http://tpetricek.github.io/FSharp.RProvider//content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/BlueMountainCapital/FSharpRProvider">github page</a></li>
        </ul>
        <h3 class="muted">R Type Provider</h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          <h1>How to</h1>

<h2>Packages</h2>

<h3>How do I Load a Package?</h3>

<p>RProvider discovers the packages installed in your R installation and makes them available as packages under the RProvider root namespace.  The actual package is lazily loaded the first time you access it.</p>

<h3>How do I install a new Package?</h3>

<p>Currently you need to load up a real R session, then install the package via install.packages, or the Packages/Install Packages... menu.  You will then need to restart Visual Studio because the set of installed packages is cached inside the RProvider.</p>

<h4>I have a package installed and it is not showing up</h4>

<p>The most likely cause is that RProvider is using a different R installation from the one you updated.  When you install R, you get the option to update the registry key <code>HKEY_LOCAL_MACHINE\SOFTWARE\R-core</code> to point to the version you are installing.  This is what RProvider uses.  If you are running in a 32-bit process, RProvider uses <code>HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R\InstallPath</code> to determine the path.  For 64-bit, it reads <code>HKEY_LOCAL_MACHINE\SOFTWARE\R-core\R64\InstallPath</code>.  When you install a package in a given version of R, it should be available in both the 32-bit and 64-bit versions.</p>

<h2>Function and Package names</h2>

<p>There are a couple of mismatches between allowed identifiers between R and F#:</p>

<h3>Dots in names</h3>

<p>It is pretty common in R to use a dot character in a name, because the character has no special meaning.  We remap dots to underscore, and underscore to a double-underscore.  So for example, data.frame() becomes R.data_frame().</p>

<h3>Names that are reserved F# keywords</h3>

<p>Some package and function names are reserved words in F#.  For these, you will need to quote them using double-backquotes.  Typically, the IDE will do this for you.  A good example is the base package, which will require an open statement where "base" is double-back-quoted.</p>

<h2>Passing Parameters</h2>

<h3>Parameter Passing Conventions</h3>

<p>R supports various kinds of parameters, which we try to map onto equivalent F# parameter types:</p>

<ul>
<li><p>All R formal parameters have names, and you can always pass their values either by name or positionally.  If you pass by name, you can skip arguments in your actual argument list.  We simply map these onto F# arguments, which you can also pass by name or positionally.</p></li>
<li><p>In R, essentially all arguments are optional (even if no default value is specified in the function argument list).  It's up to the receiving function to determine whether to error if the value is missing.   So we make all arguments optional.</p></li>
<li><p>R functions support ... (varargs/paramarray).  We map this onto a .NET ParamArray, which allows an arbitrary number of arguments to be passed.  However, there are a couple of kinks with this:</p>
<ul>
<li><p>R allows named arguments to appear <em>after</em> the ... argument, whereas .NET requires the ParamArray argument to be at the end.  Some R functions use this convention because their primary arguments are passed in the ... argument and the named arguments will sometimes be used to modify the behavior of the function.  From the RProvider you will to supply values for the positional arguments before you can pass to the ... argument.  If you don't want to supply a value to one of these arguments, you can explicitly pass System.Reflection.Missing.</p></li>
<li><p>Parameters passed to the R ... argument can also be passed using a name.  Those names are accessible to the calling function.  Example are list and dataframe construction (R.list, and R.data_frame).  To pass arguments this way, you can use the overload of each function that takes an IDictionary<string, obj>, either directly, or using the namedParams function.  For example:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="i">R</span><span class="o">.</span><span class="i">data_frame</span>(<span class="i">namedParams</span> [ <span class="s">&quot;</span><span class="s">A</span><span class="s">&quot;</span>, [|<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>|]; <span class="s">&quot;</span><span class="s">B</span><span class="s">&quot;</span>, [|<span class="n">4</span>;<span class="n">5</span>;<span class="n">6</span>|] ])</pre>
</td>
</tr>
</table></li>
</ul></li>
</ul>

<h3>Parameter Types</h3>

<p>Since all arguments to functions are of type obj, it is not necessarily obvious what you can pass.  Ultimately, you will need to know what the underlying function is expecting, but here is a table to help you.  When reading this, remember that for most types, R supports only vector types.  There are no scalar string, int, bool etc. types.</p>

<table>
<tr><th>R Type</th><th>F#/.NET Type</th></tr>
<tr><td>character</td><td>string or string[]</td></tr>
<tr><td>complex</td><td>System.Numerics.Complex or Complex[]</td></tr>
<tr><td>integer</td><td>int or int[]</td></tr>
<tr><td>logical</td><td>bool or bool[]</td></tr>
<tr><td>numeric</td><td>double or double[]</td></tr>
<tr><td>list</td><td>Call R.list, passing the values as separate arguments</td><tr>
<tr><td>dataframe</td><td>Call R.data_frame, passing column vectors in a dictionary</td><tr>
</table>

<p><strong>NB</strong>: For any input, you can also pass a SymbolicExpression instance you received as the result of calling another R function.  Doing so it a very efficient way of passing data from one function to the next, since there is no marshalling between .NET and R types in that case.</p>

<h2>Accessing results</h2>

<p>Functions exposed by the RProvider return an instance of <code>RDotNet.SymbolicExpression</code>.  This keeps all return data inside R data structures, so does not impose any data marshalling overhead.  If you want to pass the value in as an argument to another R function, you can simply do so.</p>

<p>In order to access the result in .NET code, you have three routes:</p>

<h3>Convert the data into a specified .NET type via GetValue<type>()</h3>

<p>RProvider adds a generic <code>GetValue&lt;'T&gt;</code> extension method to <code>SymbolicExpression</code>.  This supports conversions from certain R values to specific .NET types.  Here are the currently supported conversions:</p>

<table>
<tr><th>R Type</th><th>Requested F#/.NET Type</th></tr>
<tr><td>character (when vector is length 1)</td><td>string</td></tr>
<tr><td>character</td><td>string[]</td></tr>
<tr><td>complex (when vector is length 1)</td><td>Complex</td></tr>
<tr><td>complex</td><td>Complex[]</td></tr>
<tr><td>integer (when vector is length 1)</td><td>int</td></tr>
<tr><td>integer</td><td>int[]</td></tr>
<tr><td>logical (when vector is length 1)</td><td>bool</td></tr>
<tr><td>logical</td><td>bool[]</td></tr>
<tr><td>numeric (when vector is length 1)</td><td>double</td></tr>
<tr><td>numeric</td><td>double[]</td></tr>
</table>

<p>Custom conversions can be supported through <a href="plugins.html">plugins</a>.</p>

<h3>Convert the data into the default .NET type the .Value property</h3>

<p>We also expose an extension property called Value that performs a <em>default</em> conversion of a SymbolicExpresion to a .NET type.  These are the current conversions:</p>

<table>
<tr><th>R Type</th><th>F#/.NET Type</th></tr>
<tr><td>character</td><td>string[]</td></tr>
<tr><td>complex</td><td>Complex[]</td></tr>
<tr><td>integer</td><td>int[]</td></tr>
<tr><td>logical</td><td>bool[]</td></tr>
<tr><td>numeric</td><td>double[]</td></tr>
</table>

<p>Again, custom conversions can be supported through <a href="plugins.html">plugins</a>.</p>

<h3>Explicitly access the data in the SymbolicExpression</h3>

<p>If there are no supported conversions, you can access the data through the RDotNet object model.  RDotNet exposes properties, members and extension members (available only if you open the RDotNet namespace) that allow you to access the underlying data directly.  So, for example:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">res</span> <span class="o">=</span> <span class="i">R</span><span class="o">.</span><span class="i">sum</span>([|<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>|])
<span class="k">if</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">res</span><span class="o">.</span><span class="i">Type</span> <span class="o">=</span> <span class="i">RDotNet</span><span class="o">.</span><span class="i">Internals</span><span class="o">.</span><span class="i">SymbolicExpressionType</span><span class="o">.</span><span class="i">IntegerVector</span> <span class="k">then</span> <span onmouseout="hideTip(event, 'fs1', 3)" onmouseover="showTip(event, 'fs1', 3)" class="i">res</span><span class="o">.</span><span class="i">AsInteger</span>()<span class="o">.</span>[<span class="n">0</span>]
<span class="k">else</span> <span onmouseout="hideTip(event, 'fs2', 4)" onmouseover="showTip(event, 'fs2', 4)" class="i">failwithf</span> <span class="s">&quot;</span><span class="s">Expecting</span><span class="s"> </span><span class="s">a</span><span class="s"> </span><span class="s">Numeric</span><span class="s"> </span><span class="s">but</span><span class="s"> </span><span class="s">got</span><span class="s"> </span><span class="s">a</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs1', 5)" onmouseover="showTip(event, 'fs1', 5)" class="i">res</span><span class="o">.</span><span class="i">Type</span></pre>
</td>
</tr>
</table>

<p>To make this easier, we have defined some active patterns, under the RProvider.Helpers namespace, which is auto-opened when you open the RProvider namespace.  These combine the type tests and conversion.  An equivalent example:</p>

<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
<span class="l">3: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">match</span> <span class="i">R</span><span class="o">.</span><span class="i">sum</span>([|<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>|]) <span class="k">with</span> 
| <span class="i">IntegerVector</span>(<span class="i">iv</span>) <span class="k">-&gt;</span> <span class="i">iv</span><span class="o">.</span>[<span class="n">0</span>]
| _                 <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs2', 6)" onmouseover="showTip(event, 'fs2', 6)" class="i">failwithf</span> <span class="s">&quot;</span><span class="s">Expecting</span><span class="s"> </span><span class="s">a</span><span class="s"> </span><span class="s">Numeric</span><span class="s"> </span><span class="s">but</span><span class="s"> </span><span class="s">got</span><span class="s"> </span><span class="s">a</span><span class="s"> </span><span class="s">%</span><span class="s">A</span><span class="s">&quot;</span> <span onmouseout="hideTip(event, 'fs1', 7)" onmouseover="showTip(event, 'fs1', 7)" class="i">res</span><span class="o">.</span><span class="i">Type</span></pre>
</td>
</tr>
</table>

<h2>What if I commonly need an argument or result conversion that RProvider does not support?</h2>

<p>If you believe the argument conversion is universally appropriate and should be available to everybody, please fork the repo and submit a pull request.</p>

<p>RProvider also supports custom conversions to/from your own data types using <a href="plugins.html">plugins</a>.</p>

          <div class="tip" id="fs1">val res : obj<br /><br />Full name: howto.res</div>
<div class="tip" id="fs2">val failwithf : format:Printf.StringFormat&lt;&#39;T,&#39;Result&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.failwithf</div>

        </div>
        <div class="span3">

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">R Provider</li>
            <li><a href="http://tpetricek.github.io/FSharp.RProvider//index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/RProvider">Get Library via NuGet</a></li>
            <li><a href="https://github.com/BlueMountainCapital/FSharpRProvider">Source Code on GitHub</a></li>
            <li><a href="https://github.com/BlueMountainCapital/FSharpRProvider/LICENSE.md">License (Apache 2.0)</a></li>
            
            <li class="nav-header">Documentation</li>
            <li><a href="http://tpetricek.github.io/FSharp.RProvider//howto.html">How To</a></li>
            <li><a href="http://tpetricek.github.io/FSharp.RProvider//whatwhy.html">Whats and Whys</a></li>
            <li><a href="http://tpetricek.github.io/FSharp.RProvider//tutorial.html">Tutorial</a></li>
            <li class="divider"></li>
            <li><a href="http://tpetricek.github.io/FSharp.RProvider//internals.html">How Does it Work</a></li>
            <li><a href="http://tpetricek.github.io/FSharp.RProvider//plugins.html">Plugins</a></li>
          </ul>

        </div>
      </div>
    </div>
    <a href="https://github.com/BlueMountainCapital/FSharpRProvider"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>