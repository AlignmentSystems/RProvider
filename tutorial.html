<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>R Provider Tutorial
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="An F# Type Provider providing strongly typed access to the R statistical package.">
    <meta name="author" content="BlueMountain Capital">

    <script src="http://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="http://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">

    <link type="text/css" rel="stylesheet" href="http://bluemountaincapital.github.io/FSharpRProvider/content/style.css" />
    <script src="http://bluemountaincapital.github.io/FSharpRProvider/content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="https://github.com/BlueMountainCapital/FSharpRProvider">github page</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Charting/">F# Charting</a></li>
          <li><a href="http://fsharp.github.io/FSharp.Data/">F# Data</a></li>
          <li><a href="http://fsharp.org">fsharp.org</a></li>
        </ul>
        <h3 class="muted">R Type Provider</h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          <h1>R Provider Tutorial</h1>

<h2>Referencing the provider</h2>

<p>In order to use the R provider, you need to reference the <code>RDotNet.dll</code> library
(which is a .NET connector for R) and the <code>RProvider.dll</code> itself. For this tutorial,
we use <code>open</code> to reference a number of packages including <code>stats</code>, <code>tseries</code> and <code>zoo</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="prep">#I</span> <span class="s">&quot;</span><span class="s">.</span><span class="s">.</span><span class="s">/</span><span class="s">packages</span><span class="s">/</span><span class="s">RProvider</span><span class="s">.</span><span class="s">1</span><span class="s">.</span><span class="s">0</span><span class="s">.</span><span class="s">3</span><span class="s">/</span><span class="s">lib</span><span class="s">&quot;</span>
<span class="prep">#r</span> <span class="s">&quot;</span><span class="s">RDotNet</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>
<span class="prep">#r</span> <span class="s">&quot;</span><span class="s">RDotNet</span><span class="s">.</span><span class="s">FSharp</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>
<span class="prep">#r</span> <span class="s">&quot;</span><span class="s">RDotNet</span><span class="s">.</span><span class="s">NativeLibrary</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>
<span class="prep">#r</span> <span class="s">&quot;</span><span class="s">RProvider</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>
 
<span class="k">open</span> <span class="i">RDotNet</span>
<span class="k">open</span> <span class="i">RProvider</span>
<span class="k">open</span> <span class="i">RProvider</span><span class="o">.</span><span class="i">``base``</span>
<span class="k">open</span> <span class="i">RProvider</span><span class="o">.</span><span class="i">graphics</span>
<span class="k">open</span> <span class="i">RProvider</span><span class="o">.</span><span class="i">stats</span>
<span class="k">open</span> <span class="i">RProvider</span><span class="o">.</span><span class="i">tseries</span>
<span class="k">open</span> <span class="i">RProvider</span><span class="o">.</span><span class="i">zoo</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">System</span>
<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 2)" onmouseover="showTip(event, 'fs1', 2)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 3)" onmouseover="showTip(event, 'fs2', 3)" class="i">Net</span></pre>
</td>
</tr>
</table><p>If either of the namespaces above are unrecognized, you need to install the package in R
using <code>install.packages("stats")</code>.</p>

<h2>Obtaining data</h2>

<p>In this tutorial, we use <a href="http://fsharp.github.io/FSharp.Data/">F# Data</a> to access stock
prices from the Yahoo Finance portal. For more information, see the documentation for the
<a href="http://fsharp.github.io/FSharp.Data/library/CsvProvider.html">CSV type provider</a>.</p>

<p>The following snippet uses the CSV type provider to generate a type <code>Stocks</code> that can be
used for parsing CSV data from Yahoo. Then it defines a function <code>getStockPrices</code> that returns
array with prices for the specified stock and a specified number of days:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="prep">#r</span> <span class="s">&quot;</span><span class="s">FSharp</span><span class="s">.</span><span class="s">Data</span><span class="s">.</span><span class="s">dll</span><span class="s">&quot;</span>
<span class="k">open</span> <span class="i">FSharp</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 4)" onmouseover="showTip(event, 'fs3', 4)" class="i">Data</span>

<span class="k">type</span> <span onmouseout="hideTip(event, 'fs4', 5)" onmouseover="showTip(event, 'fs4', 5)" class="i">Stocks</span> <span class="o">=</span> <span class="i">CsvProvider</span><span class="o">&lt;</span><span class="s">&quot;</span><span class="s">http</span><span class="s">:</span><span class="s">/</span><span class="s">/</span><span class="s">ichart</span><span class="s">.</span><span class="s">finance</span><span class="s">.</span><span class="s">yahoo</span><span class="s">.</span><span class="s">com</span><span class="s">/</span><span class="s">table</span><span class="s">.</span><span class="s">csv</span><span class="s">?</span><span class="s">s</span><span class="s">=</span><span class="s">SPX</span><span class="s">&quot;</span><span class="o">&gt;</span>
 
<span class="c">/// Returns prices of a given stock for a specified number </span>
<span class="c">/// of days (starting from the most recent)</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs5', 6)" onmouseover="showTip(event, 'fs5', 6)" class="i">getStockPrices</span> <span onmouseout="hideTip(event, 'fs6', 7)" onmouseover="showTip(event, 'fs6', 7)" class="i">stock</span> <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="i">count</span> <span class="o">=</span>
  <span class="k">let</span> <span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="i">url</span> <span class="o">=</span> <span class="s">&quot;</span><span class="s">http</span><span class="s">:</span><span class="s">/</span><span class="s">/</span><span class="s">ichart</span><span class="s">.</span><span class="s">finance</span><span class="s">.</span><span class="s">yahoo</span><span class="s">.</span><span class="s">com</span><span class="s">/</span><span class="s">table</span><span class="s">.</span><span class="s">csv</span><span class="s">?</span><span class="s">s</span><span class="s">=</span><span class="s">&quot;</span>
  [| <span class="k">for</span> <span onmouseout="hideTip(event, 'fs9', 10)" onmouseover="showTip(event, 'fs9', 10)" class="i">r</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs4', 11)" onmouseover="showTip(event, 'fs4', 11)" class="i">Stocks</span><span class="o">.</span><span class="i">Load</span>(<span onmouseout="hideTip(event, 'fs8', 12)" onmouseover="showTip(event, 'fs8', 12)" class="i">url</span> <span class="o">+</span> <span onmouseout="hideTip(event, 'fs6', 13)" onmouseover="showTip(event, 'fs6', 13)" class="i">stock</span>)<span class="o">.</span><span class="i">Take</span>(<span onmouseout="hideTip(event, 'fs7', 14)" onmouseover="showTip(event, 'fs7', 14)" class="i">count</span>)<span class="o">.</span><span onmouseout="hideTip(event, 'fs3', 15)" onmouseover="showTip(event, 'fs3', 15)" class="i">Data</span> <span class="k">-&gt;</span> <span onmouseout="hideTip(event, 'fs10', 16)" onmouseover="showTip(event, 'fs10', 16)" class="i">float</span> <span onmouseout="hideTip(event, 'fs9', 17)" onmouseover="showTip(event, 'fs9', 17)" class="i">r</span><span class="o">.</span><span class="i">Open</span> |] 
  <span class="o">|&gt;</span> <span onmouseout="hideTip(event, 'fs11', 18)" onmouseover="showTip(event, 'fs11', 18)" class="i">Array</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 19)" onmouseover="showTip(event, 'fs12', 19)" class="i">rev</span>

<span class="c">/// Get opening prices for MSFT for the last 255 days</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs13', 20)" onmouseover="showTip(event, 'fs13', 20)" class="i">msftOpens</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs5', 21)" onmouseover="showTip(event, 'fs5', 21)" class="i">getStockPrices</span> <span class="s">&quot;</span><span class="s">MSFT</span><span class="s">&quot;</span> <span class="n">255</span></pre>
</td>
</tr>
</table><h2>Calling R functions</h2>

<p>Now, we're ready to call R functions using the type provider. The following snippet takes
<code>msftOpens</code>, calculates logarithm of the values using <code>R.log</code> and then calculates the 
differences of the resulting vector using <code>R.diff</code>:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// Retrieve stock price time series and compute returns</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs14', 22)" onmouseover="showTip(event, 'fs14', 22)" class="i">msft</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs13', 23)" onmouseover="showTip(event, 'fs13', 23)" class="i">msftOpens</span> <span class="o">|&gt;</span> <span class="i">R</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 24)" onmouseover="showTip(event, 'fs15', 24)" class="i">log</span> <span class="o">|&gt;</span> <span class="i">R</span><span class="o">.</span><span class="i">diff</span></pre>
</td>
</tr>
</table><p>If you want to see the resulting values, you can call <code>msft.AsVector()</code> in F# Interactive.
Next, we use the <code>acf</code> function to display the atuo-correlation and call <code>adf_test</code> to
see if the <code>msft</code> returns are stationary/non-unit root:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l">1: </span>
<span class="l">2: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs16', 25)" onmouseover="showTip(event, 'fs16', 25)" class="i">a</span> <span class="o">=</span> <span class="i">R</span><span class="o">.</span><span class="i">acf</span>(<span onmouseout="hideTip(event, 'fs14', 26)" onmouseover="showTip(event, 'fs14', 26)" class="i">msft</span>)
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs17', 27)" onmouseover="showTip(event, 'fs17', 27)" class="i">adf</span> <span class="o">=</span> <span class="i">R</span><span class="o">.</span><span class="i">adf_test</span>(<span onmouseout="hideTip(event, 'fs14', 28)" onmouseover="showTip(event, 'fs14', 28)" class="i">msft</span>) </pre>
</td>
</tr>
</table><p>After running the first snippet, a window similar to the following should appear (note that
it might not appear as a top-most window).</p>

<div style="text-align:center">
<img src="img/acf.png" />
</div>

<p>Finally, we can obtain data for multiple different indicators and use the <code>R.pairs</code> function
to produce a matrix of scatter plots:</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip">
<span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
</pre>
</td>
<td class="snippet"><pre class="fssnip">
<span class="c">// Build a list of tickers and get diff of logs of prices for each one</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs18', 29)" onmouseover="showTip(event, 'fs18', 29)" class="i">tickers</span> <span class="o">=</span> 
  [ <span class="s">&quot;</span><span class="s">MSFT</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">AAPL</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">X</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">VXX</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">SPX</span><span class="s">&quot;</span>; <span class="s">&quot;</span><span class="s">GLD</span><span class="s">&quot;</span> ]
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs19', 30)" onmouseover="showTip(event, 'fs19', 30)" class="i">data</span> <span class="o">=</span>
  [ <span class="k">for</span> <span onmouseout="hideTip(event, 'fs20', 31)" onmouseover="showTip(event, 'fs20', 31)" class="i">t</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs18', 32)" onmouseover="showTip(event, 'fs18', 32)" class="i">tickers</span> <span class="k">-&gt;</span> 
      <span onmouseout="hideTip(event, 'fs21', 33)" onmouseover="showTip(event, 'fs21', 33)" class="i">printfn</span> <span class="s">&quot;</span><span class="s">got</span><span class="s"> </span><span class="s">one</span><span class="s">!</span><span class="s">&quot;</span>
      <span onmouseout="hideTip(event, 'fs20', 34)" onmouseover="showTip(event, 'fs20', 34)" class="i">t</span>, <span onmouseout="hideTip(event, 'fs5', 35)" onmouseover="showTip(event, 'fs5', 35)" class="i">getStockPrices</span> <span onmouseout="hideTip(event, 'fs20', 36)" onmouseover="showTip(event, 'fs20', 36)" class="i">t</span> <span class="n">255</span> <span class="o">|&gt;</span> <span class="i">R</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs15', 37)" onmouseover="showTip(event, 'fs15', 37)" class="i">log</span> <span class="o">|&gt;</span> <span class="i">R</span><span class="o">.</span><span class="i">diff</span> ]

<span class="c">// Create an R data frame with the data and call &#39;R.pairs&#39;</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs22', 38)" onmouseover="showTip(event, 'fs22', 38)" class="i">df</span> <span class="o">=</span> <span class="i">R</span><span class="o">.</span><span class="i">data_frame</span>(<span class="i">namedParams</span> <span onmouseout="hideTip(event, 'fs19', 39)" onmouseover="showTip(event, 'fs19', 39)" class="i">data</span>)
<span class="i">R</span><span class="o">.</span><span class="i">pairs</span>(<span onmouseout="hideTip(event, 'fs22', 40)" onmouseover="showTip(event, 'fs22', 40)" class="i">df</span>)</pre>
</td>
</tr>
</table><p>As a result, you should see a window showing results similar to these:</p>

<div style="text-align:center">
<img src="img/pairs.png" />
</div>

          <div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Net</div>
<div class="tip" id="fs3">Multiple items<br />namespace System.Data<br /><br />--------------------<br />namespace Microsoft.FSharp.Data</div>
<div class="tip" id="fs4">type Stocks = obj<br /><br />Full name: Tutorial.Stocks</div>
<div class="tip" id="fs5">val getStockPrices : stock:&#39;a -&gt; count:&#39;b -&gt; float []<br /><br />Full name: Tutorial.getStockPrices<br /><em><br /><br />&#160;Returns prices of a given stock for a specified number <br />&#160;of days (starting from the most recent)</em></div>
<div class="tip" id="fs6">val stock : &#39;a</div>
<div class="tip" id="fs7">val count : &#39;b</div>
<div class="tip" id="fs8">val url : string</div>
<div class="tip" id="fs9">val r : obj</div>
<div class="tip" id="fs10">Multiple items<br />val float : value:&#39;T -&gt; float (requires member op_Explicit)<br /><br />Full name: Microsoft.FSharp.Core.Operators.float<br /><br />--------------------<br />type float&lt;&#39;Measure&gt; = float<br /><br />Full name: Microsoft.FSharp.Core.float&lt;_&gt;<br /><br />--------------------<br />type float = Double<br /><br />Full name: Microsoft.FSharp.Core.float</div>
<div class="tip" id="fs11">type Array =<br />&#160;&#160;member Clone : unit -&gt; obj<br />&#160;&#160;member CopyTo : array:Array * index:int -&gt; unit + 1 overload<br />&#160;&#160;member GetEnumerator : unit -&gt; IEnumerator<br />&#160;&#160;member GetLength : dimension:int -&gt; int<br />&#160;&#160;member GetLongLength : dimension:int -&gt; int64<br />&#160;&#160;member GetLowerBound : dimension:int -&gt; int<br />&#160;&#160;member GetUpperBound : dimension:int -&gt; int<br />&#160;&#160;member GetValue : params indices:int[] -&gt; obj + 7 overloads<br />&#160;&#160;member Initialize : unit -&gt; unit<br />&#160;&#160;member IsFixedSize : bool<br />&#160;&#160;...<br /><br />Full name: System.Array</div>
<div class="tip" id="fs12">val rev : array:&#39;T [] -&gt; &#39;T []<br /><br />Full name: Microsoft.FSharp.Collections.Array.rev</div>
<div class="tip" id="fs13">val msftOpens : float []<br /><br />Full name: Tutorial.msftOpens<br /><em><br /><br />&#160;Get opening prices for MSFT for the last 255 days</em></div>
<div class="tip" id="fs14">val msft : obj<br /><br />Full name: Tutorial.msft</div>
<div class="tip" id="fs15">val log : value:&#39;T -&gt; &#39;T (requires member Log)<br /><br />Full name: Microsoft.FSharp.Core.Operators.log</div>
<div class="tip" id="fs16">val a : obj<br /><br />Full name: Tutorial.a</div>
<div class="tip" id="fs17">val adf : obj<br /><br />Full name: Tutorial.adf</div>
<div class="tip" id="fs18">val tickers : string list<br /><br />Full name: Tutorial.tickers</div>
<div class="tip" id="fs19">val data : (string * obj) list<br /><br />Full name: Tutorial.data</div>
<div class="tip" id="fs20">val t : string</div>
<div class="tip" id="fs21">val printfn : format:Printf.TextWriterFormat&lt;&#39;T&gt; -&gt; &#39;T<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.printfn</div>
<div class="tip" id="fs22">val df : obj<br /><br />Full name: Tutorial.df</div>

        </div>
        <div class="span3">
          <a href="https://nuget.org/packages/RProvider">
            <img src="http://bluemountaincapital.github.io/FSharpRProvider/misc/logo.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
          </a>

          <ul class="nav nav-list" id="menu">
            <li class="nav-header">R Provider</li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="https://nuget.org/packages/RProvider">Get Library via NuGet</a></li>
            <li><a href="https://github.com/BlueMountainCapital/FSharpRProvider">Source Code on GitHub</a></li>
            <li><a href="https://github.com/BlueMountainCapital/FSharpRProvider/blob/master/LICENSE.md">License (BSD)</a></li>
            <li><a href="https://github.com/BlueMountainCapital/FSharpRProvider/issues">Submit bugs or feature requests</a></li>
            
      			<li class="nav-header">Documentation</li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/Charts-QuickStart.html">Creating Charts</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/Statistics-QuickStart.html">Statistics</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/passing-data.html">Passing Data between F# and R</a></li>
            <li class="divider"></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/tutorial.html">Tutorial</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/howto.html">How To</a></li>
						
            <li class="nav-header">Internals</li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/whatwhy.html">Whats and Whys</a></li>
            <li><a href="http://bluemountaincapital.github.io/FSharpRProvider/internals.html">How Does it Work</a></li>
          </ul>

        </div>
      </div>
    </div>
    <a href="https://github.com/BlueMountainCapital/FSharpRProvider"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"></a>
  </body>
  </html>